const express = require('express');
const connectDB = require('./db');
const path = require('path');
const app = express();

app.use(express.urlencoded({ extended: true }));
app.use(express.static(path.join(__dirname, 'public'))); // for static files like profile.html

// Route to fetch and display user info
app.get('/profile', async (req, res) => {
    try {
        const db = await connectDB();
        const collection = db.collection('users'); // replace with your collection name
        
        // Retrieve user information (example for a specific SRN)
        const srn = 'YourSRN'; // replace with the SRN you want to search
        const user = await collection.findOne({ srn: srn });
        
        if (user) {
            // Serve profile.html with user's data
            res.send(`
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Profile</title>
                </head>
                <body>
                    <h1>Profile Information</h1>
                    <p><strong>SRN:</strong> ${user.srn}</p>
                    <p><strong>Name:</strong> ${user.name}</p>
                    <p><strong>Email:</strong> ${user.email}</p>
                    <!-- Add more fields as needed -->
                </body>
                </html>
            `);
        } else {
            res.send(`<h1>User not found</h1>`);
        }
    } catch (error) {
        console.error('Error fetching user data:', error);
        res.status(500).send('Failed to fetch profile information');
    }
});

app.listen(3000, () => {
    console.log('Server running on http://localhost:3000');
});
